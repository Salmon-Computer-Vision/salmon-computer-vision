version: '3.8'

services:
  salmon_counter:
    image: ${IMAGE_REPO_HOST}/salmoncounter:${TAG}
    container_name: salmon_counter
    environment:
      - HOSTNAME
      - SMB_SHARE=${NETWORK_DRIVE_SHARE} # //server/share
      - FALLBACK_SHARE=/app/drive/local_hdd
      - WEIGHTS=${WEIGHTS}
    env_file:
      - ./.env
    volumes:
      - ${DRIVE}:/app/drive/hdd
      - /media/local_hdd:/app/drive/local_hdd
      - /home/${USERNAME}/config:/app/config
    network_mode: host
    runtime: nvidia
    cap_add:
      - SYS_ADMIN
      - DAC_READ_SEARCH
    restart: always
    working_dir: /app
    command: ["/app/entrypoint.sh"]

